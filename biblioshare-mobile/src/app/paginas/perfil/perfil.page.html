<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Perfil</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-refresher slot="fixed" (ionRefresh)="carregarPerfil($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-card class="ion-margin-bottom">
    <ion-card-header>
      <div class="perfil-header">
        <ion-avatar *ngIf="usuario?.foto_perfil; else avatarPlaceholder">
          <img [src]="usuario?.foto_perfil" alt="Foto do usuário" />
        </ion-avatar>
        <ng-template #avatarPlaceholder>
          <ion-avatar class="avatar-placeholder">
            <span>{{ (usuario?.first_name || usuario?.username || '?') | slice:0:1 | uppercase }}</span>
          </ion-avatar>
        </ng-template>
        <div class="perfil-info">
          <ion-card-title>{{ usuario?.first_name || usuario?.username || 'Usuário' }}</ion-card-title>
          <ion-card-subtitle>{{ usuario?.email }}</ion-card-subtitle>
        </div>
      </div>
    </ion-card-header>
    <ion-card-content>
      <ion-item lines="none">
        <ion-label>Cidade/Estado</ion-label>
        <ion-note slot="end">
          {{ usuario?.cidade || '-' }} / {{ usuario?.estado || '-' }}
        </ion-note>
      </ion-item>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Atualizar dados</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <form [formGroup]="formulario" (ngSubmit)="atualizarPerfil()">
        <ion-item lines="full">
          <ion-label position="floating">Nome</ion-label>
          <ion-input formControlName="first_name"></ion-input>
        </ion-item>
        <ion-item lines="full" class="ion-margin-top">
          <ion-label position="floating">Sobrenome</ion-label>
          <ion-input formControlName="last_name"></ion-input>
        </ion-item>
        <ion-item lines="full" class="ion-margin-top">
          <ion-label position="floating">Cidade</ion-label>
          <ion-input formControlName="cidade"></ion-input>
        </ion-item>
        <ion-item lines="full" class="ion-margin-top">
          <ion-label position="floating">Estado</ion-label>
          <ion-input formControlName="estado"></ion-input>
        </ion-item>

        <ion-button
          type="submit"
          color="primary"
          expand="block"
          class="ion-margin-top"
          [disabled]="salvando"
        >
          {{ salvando ? 'Salvando...' : 'Salvar' }}
        </ion-button>
      </form>
    </ion-card-content>
  </ion-card>
</ion-content>
